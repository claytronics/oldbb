   1               		.file	"color_change_v2.c"
   2               	__SP_H__ = 0x3e
   3               	__SP_L__ = 0x3d
   4               	__SREG__ = 0x3f
   5               	__RAMPZ__ = 0x3b
   6               	__CCP__ = 0x34
   7               	__tmp_reg__ = 0
   8               	__zero_reg__ = 1
   9               		.text
  10               	.Ltext0:
  11               	.global	nextColor
  13               	nextColor:
  14               	.LFB6:
  15               		.file 1 "arch-blocks/system/color_change_v2.bb"
   1:arch-blocks/system/color_change_v2.bb **** #include "handler.bbh"
   2:arch-blocks/system/color_change_v2.bb **** #include "block.bbh"
   3:arch-blocks/system/color_change_v2.bb **** #include "led.bbh"
   4:arch-blocks/system/color_change_v2.bb **** #include "ensemble.bbh"
   5:arch-blocks/system/color_change_v2.bb **** #include "clock.bbh"
   6:arch-blocks/system/color_change_v2.bb **** 
   7:arch-blocks/system/color_change_v2.bb **** #include "block_config.bbh"
   8:arch-blocks/system/color_change_v2.bb **** #include "memory.bbh"
   9:arch-blocks/system/color_change_v2.bb **** //#include "hw-api/hwMemory.h"
  10:arch-blocks/system/color_change_v2.bb **** 
  11:arch-blocks/system/color_change_v2.bb **** #ifdef LOG_DEBUG
  12:arch-blocks/system/color_change_v2.bb **** #include "log.bbh"
  13:arch-blocks/system/color_change_v2.bb **** #endif
  14:arch-blocks/system/color_change_v2.bb **** 
  15:arch-blocks/system/color_change_v2.bb **** #define PERIOD (3000)
  16:arch-blocks/system/color_change_v2.bb **** 
  17:arch-blocks/system/color_change_v2.bb **** // enum{RED, ORANGE, YELLOW, GREEN, AQUA, BLUE, WHITE, PURPLE, PINK, NUM_COLORS};	
  18:arch-blocks/system/color_change_v2.bb **** 
  19:arch-blocks/system/color_change_v2.bb **** Color nextColor() {
  16               		.loc 1 19 0
  17               	/* prologue: function */
  18               	/* frame size = 0 */
  19               	/* stack size = 0 */
  20               	.L__stack_usage = 0
  21               	.LVL0:
  20:arch-blocks/system/color_change_v2.bb **** 	Color c = 0;
  21:arch-blocks/system/color_change_v2.bb **** 	c = (getClock()/PERIOD)%NUM_COLORS;
  22               		.loc 1 21 0
  23 0000 0E94 0000 		call getClock
  24               	.LVL1:
  25 0004 28EB      		ldi r18,lo8(-72)
  26 0006 3BE0      		ldi r19,lo8(11)
  27 0008 40E0      		ldi r20,0
  28 000a 50E0      		ldi r21,0
  29 000c 0E94 0000 		call __udivmodsi4
  30 0010 CA01      		movw r24,r20
  31 0012 B901      		movw r22,r18
  32 0014 29E0      		ldi r18,lo8(9)
  33 0016 30E0      		ldi r19,0
  34 0018 40E0      		ldi r20,0
  35 001a 50E0      		ldi r21,0
  36 001c 0E94 0000 		call __udivmodsi4
  37 0020 862F      		mov r24,r22
  38               	.LVL2:
  22:arch-blocks/system/color_change_v2.bb **** 	if ((c == AQUA) || (c == WHITE))
  39               		.loc 1 22 0
  40 0022 6430      		cpi r22,lo8(4)
  41 0024 01F0      		breq .L4
  42               		.loc 1 22 0 is_stmt 0 discriminator 1
  43 0026 6630      		cpi r22,lo8(6)
  44 0028 01F4      		brne .L2
  45               	.L4:
  23:arch-blocks/system/color_change_v2.bb **** 	{
  24:arch-blocks/system/color_change_v2.bb **** 		c = ORANGE;
  46               		.loc 1 24 0 is_stmt 1
  47 002a 81E0      		ldi r24,lo8(1)
  48               	.L2:
  49               	.LVL3:
  25:arch-blocks/system/color_change_v2.bb **** 	}
  26:arch-blocks/system/color_change_v2.bb **** 	return c;
  27:arch-blocks/system/color_change_v2.bb **** }
  50               		.loc 1 27 0
  51 002c 0895      		ret
  52               	.LFE6:
  54               	.global	myMain
  56               	myMain:
  57               	.LFB7:
  28:arch-blocks/system/color_change_v2.bb **** 
  29:arch-blocks/system/color_change_v2.bb **** void myMain(void)
  30:arch-blocks/system/color_change_v2.bb **** {
  58               		.loc 1 30 0
  59               	/* prologue: function */
  60               	/* frame size = 0 */
  61               	/* stack size = 0 */
  62               	.L__stack_usage = 0
  63               	.LVL4:
  31:arch-blocks/system/color_change_v2.bb **** 	Time changeT = PERIOD;
  32:arch-blocks/system/color_change_v2.bb **** 	
  33:arch-blocks/system/color_change_v2.bb **** 	while(getNeighborCount() == 0)
  64               		.loc 1 33 0
  65 002e 00C0      		rjmp .L6
  66               	.L7:
  34:arch-blocks/system/color_change_v2.bb **** 	{
  35:arch-blocks/system/color_change_v2.bb **** 		setColor(WHITE);
  67               		.loc 1 35 0
  68 0030 86E0      		ldi r24,lo8(6)
  69 0032 0E94 0000 		call setColor
  70               	.LVL5:
  71               	.L6:
  33:arch-blocks/system/color_change_v2.bb **** 	while(getNeighborCount() == 0)
  72               		.loc 1 33 0 discriminator 1
  73 0036 0E94 0000 		call getNeighborCount
  74               	.LVL6:
  75 003a 8823      		tst r24
  76 003c 01F0      		breq .L7
  77 003e 00C0      		rjmp .L15
  78               	.L9:
  36:arch-blocks/system/color_change_v2.bb **** 	}
  37:arch-blocks/system/color_change_v2.bb **** 	
  38:arch-blocks/system/color_change_v2.bb **** 	while (!isSynchronized())
  39:arch-blocks/system/color_change_v2.bb **** 	{
  40:arch-blocks/system/color_change_v2.bb **** 		setColor(AQUA);
  79               		.loc 1 40 0
  80 0040 84E0      		ldi r24,lo8(4)
  81 0042 0E94 0000 		call setColor
  82               	.LVL7:
  41:arch-blocks/system/color_change_v2.bb **** 		delayMS(6);
  83               		.loc 1 41 0
  84 0046 86E0      		ldi r24,lo8(6)
  85 0048 90E0      		ldi r25,0
  86 004a 0E94 0000 		call delayMS
  87               	.LVL8:
  88               	.L15:
  38:arch-blocks/system/color_change_v2.bb **** 	while (!isSynchronized())
  89               		.loc 1 38 0 discriminator 1
  90 004e 0E94 0000 		call isSynchronized
  91               	.LVL9:
  92 0052 8823      		tst r24
  93 0054 01F0      		breq .L9
  42:arch-blocks/system/color_change_v2.bb **** 	}
  43:arch-blocks/system/color_change_v2.bb **** 	
  44:arch-blocks/system/color_change_v2.bb **** 	setColor(nextColor());
  94               		.loc 1 44 0
  95 0056 0E94 0000 		call nextColor
  96               	.LVL10:
  97 005a 0E94 0000 		call setColor
  98               	.LVL11:
  45:arch-blocks/system/color_change_v2.bb **** 	changeT = (getClock()/PERIOD)*PERIOD + PERIOD;
  99               		.loc 1 45 0
 100 005e 0E94 0000 		call getClock
 101               	.LVL12:
 102 0062 28EB      		ldi r18,lo8(-72)
 103 0064 3BE0      		ldi r19,lo8(11)
 104 0066 40E0      		ldi r20,0
 105 0068 50E0      		ldi r21,0
 106 006a 0E94 0000 		call __udivmodsi4
 107 006e 2F5F      		subi r18,-1
 108 0070 3F4F      		sbci r19,-1
 109 0072 4F4F      		sbci r20,-1
 110 0074 5F4F      		sbci r21,-1
 111 0076 A8EB      		ldi r26,lo8(-72)
 112 0078 BBE0      		ldi r27,lo8(11)
 113 007a 0E94 0000 		call __muluhisi3
 114 007e 6B01      		movw r12,r22
 115 0080 7C01      		movw r14,r24
 116               	.LVL13:
  46:arch-blocks/system/color_change_v2.bb **** 
  47:arch-blocks/system/color_change_v2.bb **** 	while (1) {
  48:arch-blocks/system/color_change_v2.bb **** 		while(getClock() < changeT)
  49:arch-blocks/system/color_change_v2.bb **** 		{
  50:arch-blocks/system/color_change_v2.bb **** 			delayMS(1);
  51:arch-blocks/system/color_change_v2.bb **** 		}
  52:arch-blocks/system/color_change_v2.bb **** 		/*#ifdef LOG_DEBUG
  53:arch-blocks/system/color_change_v2.bb **** 			char s[150];
  54:arch-blocks/system/color_change_v2.bb **** 			snprintf(s, 150*sizeof(char), "color change: t: %lu, c: %lu", getTime(), getClock());
  55:arch-blocks/system/color_change_v2.bb **** 			s[149] = '\0';
  56:arch-blocks/system/color_change_v2.bb **** 			printDebug(s);
  57:arch-blocks/system/color_change_v2.bb **** 		#endif*/
  58:arch-blocks/system/color_change_v2.bb **** 		//printf("clock %u\n", getClock());
  59:arch-blocks/system/color_change_v2.bb **** 		if (isTimeLeader()) {
  60:arch-blocks/system/color_change_v2.bb **** 			setColor(RED);
  61:arch-blocks/system/color_change_v2.bb **** 		} else {
  62:arch-blocks/system/color_change_v2.bb **** 			setColor(nextColor());
  63:arch-blocks/system/color_change_v2.bb **** 		}
  64:arch-blocks/system/color_change_v2.bb **** 		delayMS(1);
  65:arch-blocks/system/color_change_v2.bb **** 		changeT = (getClock()/PERIOD)*PERIOD + PERIOD;
 117               		.loc 1 65 0
 118 0082 88EB      		ldi r24,lo8(-72)
 119 0084 882E      		mov r8,r24
 120 0086 8BE0      		ldi r24,lo8(11)
 121 0088 982E      		mov r9,r24
 122 008a A12C      		mov r10,__zero_reg__
 123 008c B12C      		mov r11,__zero_reg__
 124 008e 00C0      		rjmp .L16
 125               	.L11:
  50:arch-blocks/system/color_change_v2.bb **** 			delayMS(1);
 126               		.loc 1 50 0
 127 0090 81E0      		ldi r24,lo8(1)
 128 0092 90E0      		ldi r25,0
 129 0094 0E94 0000 		call delayMS
 130               	.LVL14:
 131               	.L16:
  48:arch-blocks/system/color_change_v2.bb **** 		while(getClock() < changeT)
 132               		.loc 1 48 0 discriminator 1
 133 0098 0E94 0000 		call getClock
 134               	.LVL15:
 135 009c 6C15      		cp r22,r12
 136 009e 7D05      		cpc r23,r13
 137 00a0 8E05      		cpc r24,r14
 138 00a2 9F05      		cpc r25,r15
 139 00a4 00F0      		brlo .L11
  59:arch-blocks/system/color_change_v2.bb **** 		if (isTimeLeader()) {
 140               		.loc 1 59 0
 141 00a6 0E94 0000 		call isTimeLeader
 142               	.LVL16:
 143 00aa 8823      		tst r24
 144 00ac 01F0      		breq .L12
  60:arch-blocks/system/color_change_v2.bb **** 			setColor(RED);
 145               		.loc 1 60 0
 146 00ae 80E0      		ldi r24,0
 147 00b0 00C0      		rjmp .L17
 148               	.L12:
  62:arch-blocks/system/color_change_v2.bb **** 			setColor(nextColor());
 149               		.loc 1 62 0
 150 00b2 0E94 0000 		call nextColor
 151               	.LVL17:
 152               	.L17:
 153 00b6 0E94 0000 		call setColor
 154               	.LVL18:
  64:arch-blocks/system/color_change_v2.bb **** 		delayMS(1);
 155               		.loc 1 64 0
 156 00ba 81E0      		ldi r24,lo8(1)
 157 00bc 90E0      		ldi r25,0
 158 00be 0E94 0000 		call delayMS
 159               	.LVL19:
 160               		.loc 1 65 0
 161 00c2 0E94 0000 		call getClock
 162               	.LVL20:
 163 00c6 A501      		movw r20,r10
 164 00c8 9401      		movw r18,r8
 165 00ca 0E94 0000 		call __udivmodsi4
 166 00ce 2F5F      		subi r18,-1
 167 00d0 3F4F      		sbci r19,-1
 168 00d2 4F4F      		sbci r20,-1
 169 00d4 5F4F      		sbci r21,-1
 170 00d6 A8EB      		ldi r26,lo8(-72)
 171 00d8 BBE0      		ldi r27,lo8(11)
 172 00da 0E94 0000 		call __muluhisi3
 173 00de 6B01      		movw r12,r22
 174 00e0 7C01      		movw r14,r24
 175               	.LVL21:
  66:arch-blocks/system/color_change_v2.bb **** 		//changeT += PERIOD;
  67:arch-blocks/system/color_change_v2.bb **** 	}
 176               		.loc 1 67 0
 177 00e2 00C0      		rjmp .L16
 178               	.LFE7:
 180               	.global	userRegistration
 182               	userRegistration:
 183               	.LFB8:
  68:arch-blocks/system/color_change_v2.bb **** 	//printf("Color Change Clock %u\n", getClock());
  69:arch-blocks/system/color_change_v2.bb **** 	
  70:arch-blocks/system/color_change_v2.bb **** 	while(1);
  71:arch-blocks/system/color_change_v2.bb **** }
  72:arch-blocks/system/color_change_v2.bb **** void userRegistration(void)
  73:arch-blocks/system/color_change_v2.bb **** {
 184               		.loc 1 73 0
 185               	/* prologue: function */
 186               	/* frame size = 0 */
 187               	/* stack size = 0 */
 188               	.L__stack_usage = 0
  74:arch-blocks/system/color_change_v2.bb **** 	registerHandler(SYSTEM_MAIN, (GenericHandler)&myMain);	
 189               		.loc 1 74 0
 190 00e4 60E0      		ldi r22,lo8(gs(myMain))
 191 00e6 70E0      		ldi r23,hi8(gs(myMain))
 192 00e8 81E0      		ldi r24,lo8(1)
 193 00ea 0C94 0000 		jmp registerHandler
 194               	.LVL22:
 195               	.LFE8:
 239               	.Letext0:
 240               		.file 2 "/usr/lib/gcc/avr/4.7.2/../../../avr/include/stdint.h"
 241               		.file 3 "/home/pthalamy/CMU/build-modif/src-bobby/system/defs.bbh"
 242               		.file 4 "/home/pthalamy/CMU/build-modif/src-bobby/system/handler.bbh"
 243               		.file 5 "/home/pthalamy/CMU/build-modif/src-bobby/system/hardwaretime.bbh"
 244               		.file 6 "/home/pthalamy/CMU/build-modif/src-bobby/system/led.bbh"
 245               		.file 7 "/home/pthalamy/CMU/build-modif/src-bobby/system/clock.bbh"
 246               		.file 8 "/home/pthalamy/CMU/build-modif/src-bobby/system/ensemble.bbh"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 color_change_v2.c
     /tmp/cc5iTA72.s:2      *ABS*:000000000000003e __SP_H__
     /tmp/cc5iTA72.s:3      *ABS*:000000000000003d __SP_L__
     /tmp/cc5iTA72.s:4      *ABS*:000000000000003f __SREG__
     /tmp/cc5iTA72.s:5      *ABS*:000000000000003b __RAMPZ__
     /tmp/cc5iTA72.s:6      *ABS*:0000000000000034 __CCP__
     /tmp/cc5iTA72.s:7      *ABS*:0000000000000000 __tmp_reg__
     /tmp/cc5iTA72.s:8      *ABS*:0000000000000001 __zero_reg__
     /tmp/cc5iTA72.s:13     .text:0000000000000000 nextColor
     /tmp/cc5iTA72.s:56     .text:000000000000002e myMain
     /tmp/cc5iTA72.s:182    .text:00000000000000e4 userRegistration

UNDEFINED SYMBOLS
getClock
__udivmodsi4
setColor
getNeighborCount
delayMS
isSynchronized
__muluhisi3
isTimeLeader
registerHandler
