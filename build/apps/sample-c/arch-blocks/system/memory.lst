   1               		.file	"memory.c"
   2               	__SP_H__ = 0x3e
   3               	__SP_L__ = 0x3d
   4               	__SREG__ = 0x3f
   5               	__RAMPZ__ = 0x3b
   6               	__CCP__ = 0x34
   7               	__tmp_reg__ = 0
   8               	__zero_reg__ = 1
   9               		.text
  10               	.Ltext0:
  11               	.global	initializeMemory
  13               	initializeMemory:
  14               	.LFB6:
  15               		.file 1 "/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb"
   1:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** // memory.c
   2:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** //
   3:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** // Implement Memory Management protocols
   4:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 
   5:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** #ifndef _MEMORY_C_
   6:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** #define _MEMORY_C_
   7:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 
   8:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** #include "memory.bbh"
   9:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 
  10:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** threaddef #define NUM_RXCHUNKS 12
  11:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** threaddef #define NUM_TXCHUNKS 12
  12:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 
  13:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** // types of chunks to free
  14:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** #define RXCHUNK 0
  15:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** #define TXCHUNK 1
  16:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 
  17:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** threadvar byte numFreeChunks;
  18:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** threadvar Chunk rxChunks[NUM_RXCHUNKS];
  19:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** threadvar Chunk txChunks[NUM_TXCHUNKS];
  20:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 
  21:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** threadvar blockConf EEMEM nv_conf;
  22:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** threadvar blockConf conf;
  23:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 
  24:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** //////////////////// PUBLIC FUNCTIONS /////////////////////
  25:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** // set-up memory
  26:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** void initializeMemory(void)
  27:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** {
  16               		.loc 1 27 0
  17               	/* prologue: function */
  18               	/* frame size = 0 */
  19               	/* stack size = 0 */
  20               	.L__stack_usage = 0
  21               	.LVL0:
  22 0000 E0E0      		ldi r30,lo8(rxChunks+17)
  23 0002 F0E0      		ldi r31,hi8(rxChunks+17)
  24               	.LVL1:
  25               	.L2:
  28:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     uint8_t i;
  29:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 
  30:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     // clear all status bits for receive chunks
  31:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     for( i=0; i<NUM_RXCHUNKS; i++ )
  32:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     {
  33:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****         rxChunks[i].status = CHUNK_FREE;
  26               		.loc 1 33 0 discriminator 2
  27 0004 1082      		st Z,__zero_reg__
  28 0006 7896      		adiw r30,24
  31:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     for( i=0; i<NUM_RXCHUNKS; i++ )
  29               		.loc 1 31 0 discriminator 2
  30 0008 80E0      		ldi r24,hi8(rxChunks+305)
  31 000a E030      		cpi r30,lo8(rxChunks+305)
  32 000c F807      		cpc r31,r24
  33 000e 01F4      		brne .L2
  34 0010 E0E0      		ldi r30,lo8(txChunks+17)
  35 0012 F0E0      		ldi r31,hi8(txChunks+17)
  36               	.L3:
  34:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     }
  35:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     
  36:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     // clear all status bits for receive chunks
  37:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     for( i=0; i<NUM_TXCHUNKS; i++ )
  38:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     {
  39:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****         txChunks[i].status = CHUNK_FREE;
  37               		.loc 1 39 0 discriminator 2
  38 0014 1082      		st Z,__zero_reg__
  39 0016 7896      		adiw r30,24
  37:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     for( i=0; i<NUM_TXCHUNKS; i++ )
  40               		.loc 1 37 0 discriminator 2
  41 0018 80E0      		ldi r24,hi8(txChunks+305)
  42 001a E030      		cpi r30,lo8(txChunks+305)
  43 001c F807      		cpc r31,r24
  44 001e 01F4      		brne .L3
  45               	/* epilogue start */
  40:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     }
  41:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 
  42:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     // load config data
  43:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     //TODO: re-enable
  44:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     //restore(&conf, &nv_conf, sizeof(blockConf));
  45:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** }
  46               		.loc 1 45 0
  47 0020 0895      		ret
  48               	.LFE6:
  50               	.global	freeChunk
  52               	freeChunk:
  53               	.LFB7:
  46:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 
  47:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** // this loops through and frees all connected Chunks in the list.
  48:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** void freeChunk(Chunk * c)
  49:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** {
  54               		.loc 1 49 0
  55               	.LVL2:
  56               	/* prologue: function */
  57               	/* frame size = 0 */
  58               	/* stack size = 0 */
  59               	.L__stack_usage = 0
  60 0022 FC01      		movw r30,r24
  50:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****   Chunk * tmp;	
  51:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 
  52:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****   while(c != NULL)
  61               		.loc 1 52 0
  62 0024 00C0      		rjmp .L7
  63               	.LVL3:
  64               	.L9:
  53:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     {
  54:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****       if(chunkInUse(c))
  65               		.loc 1 54 0
  66 0026 8189      		ldd r24,Z+17
  67 0028 87FD      		sbrc r24,7
  55:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****         {
  56:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 	  c->status = CHUNK_FREE;
  68               		.loc 1 56 0
  69 002a 118A      		std Z+17,__zero_reg__
  70               	.L8:
  57:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****         }
  58:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****       tmp = c->next;
  71               		.loc 1 58 0
  72 002c 9289      		ldd r25,Z+18
  73 002e 8389      		ldd r24,Z+19
  74               	.LVL4:
  59:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****       c->next = NULL;
  75               		.loc 1 59 0
  76 0030 128A      		std Z+18,__zero_reg__
  77 0032 138A      		std Z+19,__zero_reg__
  78               	.LVL5:
  60:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****       c = tmp;
  79               		.loc 1 60 0
  80 0034 E92F      		mov r30,r25
  81 0036 F82F      		mov r31,r24
  82               	.LVL6:
  83               	.L7:
  52:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****   while(c != NULL)
  84               		.loc 1 52 0 discriminator 1
  85 0038 3097      		sbiw r30,0
  86 003a 01F4      		brne .L9
  87               	/* epilogue start */
  61:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     }
  62:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** }
  88               		.loc 1 62 0
  89 003c 0895      		ret
  90               	.LFE7:
  92               	.global	getSystemChunk
  94               	getSystemChunk:
  95               	.LFB8:
  63:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 
  64:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** Chunk* getSystemChunk(byte which)
  65:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** {
  96               		.loc 1 65 0
  97               	.LVL7:
  98               	/* prologue: function */
  99               	/* frame size = 0 */
 100               	/* stack size = 0 */
 101               	.L__stack_usage = 0
  66:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     int8_t i;
  67:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     Chunk*  current;
  68:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 
  69:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     if(which == RXCHUNK)
 102               		.loc 1 69 0
 103 003e 8111      		cpse r24,__zero_reg__
 104 0040 00C0      		rjmp .L18
  70:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****       {
  71:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 	current = rxChunks;
 105               		.loc 1 71 0
 106 0042 80E0      		ldi r24,lo8(rxChunks)
 107 0044 90E0      		ldi r25,hi8(rxChunks)
 108               	.LVL8:
 109 0046 00C0      		rjmp .L14
 110               	.LVL9:
 111               	.L18:
  72:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 
  73:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 	i = NUM_RXCHUNKS-1;
  74:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****       }
  75:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     else
  76:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****       {
  77:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 	current = txChunks;
 112               		.loc 1 77 0
 113 0048 80E0      		ldi r24,lo8(txChunks)
 114 004a 90E0      		ldi r25,hi8(txChunks)
 115               	.LVL10:
 116               	.L14:
  71:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 	current = rxChunks;
 117               		.loc 1 71 0 discriminator 1
 118 004c 2CE0      		ldi r18,lo8(12)
 119               	.LVL11:
 120               	.L17:
  64:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** Chunk* getSystemChunk(byte which)
 121               		.loc 1 64 0
 122 004e FC01      		movw r30,r24
 123 0050 E85F      		subi r30,-8
 124 0052 FE4F      		sbci r31,-2
 125 0054 DC01      		movw r26,r24
 126 0056 A75E      		subi r26,-25
 127 0058 BE4F      		sbci r27,-2
  78:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 
  79:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 	i = NUM_TXCHUNKS-1;
  80:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****       }
  81:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 
  82:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     // look for unused Chunk
  83:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     for(; i>=0; i--)
  84:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     {
  85:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****         // check top bit to indicate usage
  86:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****       if( !chunkInUse((&(current[i]))) )
 128               		.loc 1 86 0
 129 005a 3C91      		ld r19,X
 130 005c 37FD      		sbrc r19,7
 131 005e 00C0      		rjmp .L15
  87:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****         {
  88:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****             // indicate in use
  89:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 	  (current[i]).status = CHUNK_USED;
 132               		.loc 1 89 0
 133 0060 80E8      		ldi r24,lo8(-128)
 134 0062 818B      		std Z+17,r24
  90:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****           
  91:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 	  // clear old next ptr in case non-NULL
  92:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 	  (current[i]).next = NULL;
 135               		.loc 1 92 0
 136 0064 128A      		std Z+18,__zero_reg__
 137 0066 138A      		std Z+19,__zero_reg__
  93:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 	  return &(current[i]);
 138               		.loc 1 93 0
 139 0068 00C0      		rjmp .L16
 140               	.L15:
 141 006a 2150      		subi r18,lo8(-(-1))
 142 006c 4897      		sbiw r24,24
  83:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     for(; i>=0; i--)
 143               		.loc 1 83 0
 144 006e 2111      		cpse r18,__zero_reg__
 145 0070 00C0      		rjmp .L17
  94:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****         }
  95:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****         // else, in use (supposedly)
  96:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     }
  97:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     // none free!
  98:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****     return NULL;  
 146               		.loc 1 98 0
 147 0072 E0E0      		ldi r30,0
 148 0074 F0E0      		ldi r31,0
 149               	.L16:
  99:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** }
 150               		.loc 1 99 0
 151 0076 CF01      		movw r24,r30
 152 0078 0895      		ret
 153               	.LFE8:
 155               	.global	getSystemRXChunk
 157               	getSystemRXChunk:
 158               	.LFB9:
 100:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 
 101:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** // return pointer to free memory Chunk
 102:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** Chunk* getSystemRXChunk()
 103:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** {
 159               		.loc 1 103 0
 160               	/* prologue: function */
 161               	/* frame size = 0 */
 162               	/* stack size = 0 */
 163               	.L__stack_usage = 0
 104:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****   return getSystemChunk(RXCHUNK);
 164               		.loc 1 104 0
 165 007a 80E0      		ldi r24,0
 166 007c 0C94 0000 		jmp getSystemChunk
 167               	.LVL12:
 168               	.LFE9:
 170               	.global	getSystemTXChunk
 172               	getSystemTXChunk:
 173               	.LFB10:
 105:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** }
 106:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** 
 107:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** Chunk* getSystemTXChunk()
 108:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb **** {
 174               		.loc 1 108 0
 175               	/* prologue: function */
 176               	/* frame size = 0 */
 177               	/* stack size = 0 */
 178               	.L__stack_usage = 0
 109:/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bb ****   return getSystemChunk(TXCHUNK);
 179               		.loc 1 109 0
 180 0080 81E0      		ldi r24,lo8(1)
 181 0082 0C94 0000 		jmp getSystemChunk
 182               	.LVL13:
 183               	.LFE10:
 185               		.comm	conf,4,1
 186               	.global	nv_conf
 187               		.section	.eeprom,"aw",@progbits
 190               	nv_conf:
 191 0000 0000 0000 		.zero	4
 192               		.comm	txChunks,288,1
 193               		.comm	rxChunks,288,1
 194               		.comm	numFreeChunks,1,1
 253               	.Letext0:
 254               		.file 2 "/usr/lib/gcc/avr/4.7.2/../../../avr/include/stdint.h"
 255               		.file 3 "/home/pthalamy/CMU/oldbb/build/src-bobby/system/defs.bbh"
 256               		.file 4 "/home/pthalamy/CMU/oldbb/build/src-bobby/system/handler.bbh"
 257               		.file 5 "/home/pthalamy/CMU/oldbb/build/src-bobby/system/memory.bbh"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 memory.c
     /tmp/ccJ7UudO.s:2      *ABS*:000000000000003e __SP_H__
     /tmp/ccJ7UudO.s:3      *ABS*:000000000000003d __SP_L__
     /tmp/ccJ7UudO.s:4      *ABS*:000000000000003f __SREG__
     /tmp/ccJ7UudO.s:5      *ABS*:000000000000003b __RAMPZ__
     /tmp/ccJ7UudO.s:6      *ABS*:0000000000000034 __CCP__
     /tmp/ccJ7UudO.s:7      *ABS*:0000000000000000 __tmp_reg__
     /tmp/ccJ7UudO.s:8      *ABS*:0000000000000001 __zero_reg__
     /tmp/ccJ7UudO.s:13     .text:0000000000000000 initializeMemory
                            *COM*:0000000000000120 rxChunks
                            *COM*:0000000000000120 txChunks
     /tmp/ccJ7UudO.s:52     .text:0000000000000022 freeChunk
     /tmp/ccJ7UudO.s:94     .text:000000000000003e getSystemChunk
     /tmp/ccJ7UudO.s:157    .text:000000000000007a getSystemRXChunk
     /tmp/ccJ7UudO.s:172    .text:0000000000000080 getSystemTXChunk
                            *COM*:0000000000000004 conf
     /tmp/ccJ7UudO.s:190    .eeprom:0000000000000000 nv_conf
                            *COM*:0000000000000001 numFreeChunks

UNDEFINED SYMBOLS
__do_clear_bss
