   1               		.file	"data_link.c"
   2               	__SP_H__ = 0x3e
   3               	__SP_L__ = 0x3d
   4               	__SREG__ = 0x3f
   5               	__RAMPZ__ = 0x3b
   6               	__CCP__ = 0x34
   7               	__tmp_reg__ = 0
   8               	__zero_reg__ = 1
   9               		.text
  10               	.Ltext0:
  11               	.global	defaultMsgHandler
  13               	defaultMsgHandler:
  14               	.LFB6:
  15               		.file 1 "/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb"
   1:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** // data_link.c
   2:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** //
   3:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** // Implement Data Link Layer protocols
   4:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
   5:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #ifndef _DATA_LINK_C_
   6:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #define _DATA_LINK_C_
   7:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
   8:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #include "../hw-api/hwDataLink.h"
   9:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #include "../hw-api/hwSerial.h"
  10:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #include "data_link.bbh"
  11:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #include "led.bbh"
  12:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
  13:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #ifdef LOG_DEBUG
  14:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #include "log.bbh"
  15:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #endif
  16:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #ifdef CLOCK_SYNC
  17:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #include "clock.bbh"
  18:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #endif
  19:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
  20:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
  21:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** // global receive queue for packets
  22:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** // move to network layer???
  23:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** threadvar ReceivePacketQueue globalRq;
  24:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
  25:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** threadextern Port port[NUM_PORTS];
  26:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
  27:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** // used to allow message handler and callbacks access to state
  28:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** threadvar Chunk* thisChunk;
  29:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
  30:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** /////////////////// PROTECTED FUNCTIONS ///////////////////
  31:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** // default message handler - does nothing
  32:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** byte defaultMsgHandler(void)
  33:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** {
  16               		.loc 1 33 0
  17               	/* prologue: function */
  18               	/* frame size = 0 */
  19               	/* stack size = 0 */
  20               	.L__stack_usage = 0
  34:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     return 1;
  35:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** }
  21               		.loc 1 35 0
  22 0000 81E0      		ldi r24,lo8(1)
  23 0002 0895      		ret
  24               	.LFE6:
  26               	.global	reservedSystemHandler
  28               	reservedSystemHandler:
  29               	.LFB7:
  36:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
  37:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** // handler for reserved system mesages
  38:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** //   using 0x0000 as message handler allows blocks 
  39:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** //   running different programs to communicate at the system level.
  40:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** byte reservedSystemHandler(void)
  41:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** {
  30               		.loc 1 41 0
  31               	/* prologue: function */
  32               	/* frame size = 0 */
  33               	/* stack size = 0 */
  34               	.L__stack_usage = 0
  42:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     // bogus
  43:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     if(thisChunk == NULL) {
  35               		.loc 1 43 0
  36 0004 E091 0000 		lds r30,thisChunk
  37 0008 F091 0000 		lds r31,thisChunk+1
  38 000c 3097      		sbiw r30,0
  39 000e 01F0      		breq .L3
  44:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         return 0;
  45:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     }
  46:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****   
  47:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     // find msg type and check
  48:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     switch( thisChunk->data[0] )
  40               		.loc 1 48 0
  41 0010 8081      		ld r24,Z
  42 0012 8036      		cpi r24,lo8(96)
  43 0014 01F0      		breq .L5
  44 0016 8F3F      		cpi r24,lo8(-1)
  45 0018 01F0      		breq .L6
  46 001a 8130      		cpi r24,lo8(1)
  47 001c 01F4      		brne .L3
  48 001e 00C0      		rjmp .L4
  49               	.L6:
  50               	.LBB12:
  49:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     {
  50:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         case JUMP_BOOTLOADER: // CRC for this message: 0x2A
  51:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         {
  52:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 	        int i = 1;
  53:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 	
  54:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 	        // check msg consistency
  55:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 	        while( i < DATA_SIZE ) {
  56:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 	            if( thisChunk->data[i] != (JUMP_BOOTLOADER ^ i) ) {
  57:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 	                // invalid bootloader packet, break and do nothing
  58:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 	                break;
  59:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 	            }
  60:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 	            i++;
  61:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 	        }
  62:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 	        // consistent
  63:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     	    jumpToBootSection();
  51               		.loc 1 63 0
  52 0020 0E94 0000 		call jumpToBootSection
  53               	.LVL0:
  54               	.L4:
  55               	.LBE12:
  64:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         }
  65:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         case NEIGHBOR_MSG:
  66:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****             handleNeighborMessage();
  56               		.loc 1 66 0
  57 0024 0E94 0000 		call handleNeighborMessage
  58               	.LVL1:
  67:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****             break;
  59               		.loc 1 67 0
  60 0028 00C0      		rjmp .L3
  61               	.L5:
  68:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #ifdef LOG_DEBUG
  69:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         case LOG_MSG:
  70:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 			handleLogMessage();
  71:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 			break;
  72:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #endif
  73:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #ifdef CLOCK_SYNC
  74:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 		case CLOCK_SYNC_MSG:
  75:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 			handleClockSyncMessage();
  62               		.loc 1 75 0
  63 002a 0E94 0000 		call handleClockSyncMessage
  64               	.LVL2:
  65               	.L3:
  76:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 			break;
  77:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #endif
  78:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         default:
  79:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****             break;
  80:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     }
  81:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****   
  82:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     return 0;
  83:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** }
  66               		.loc 1 83 0
  67 002e 80E0      		ldi r24,0
  68 0030 0895      		ret
  69               	.LFE7:
  71               	.global	removeFromSq
  73               	removeFromSq:
  74               	.LFB8:
  84:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
  85:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** // removes the first packet from the send queue and
  86:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** //    updates pointers
  87:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** //    updates pointers
  88:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** // inputs:  port
  89:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** // output:  1-success, 0-failure
  90:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** byte removeFromSq(PRef p, byte response)
  91:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** {
  75               		.loc 1 91 0
  76               	.LVL3:
  77               	/* prologue: function */
  78               	/* frame size = 0 */
  79               	/* stack size = 0 */
  80               	.L__stack_usage = 0
  92:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     // empty or bad
  93:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     if( (p >= NUM_PORTS) || (port[p].sq.head == NULL) ) 
  81               		.loc 1 93 0
  82 0032 8630      		cpi r24,lo8(6)
  83 0034 00F0      		brlo .+2
  84 0036 00C0      		rjmp .L20
  85               		.loc 1 93 0 is_stmt 0 discriminator 1
  86 0038 98E5      		ldi r25,lo8(88)
  87 003a 899F      		mul r24,r25
  88 003c F001      		movw r30,r0
  89 003e 1124      		clr __zero_reg__
  90 0040 E050      		subi r30,lo8(-(port))
  91 0042 F040      		sbci r31,hi8(-(port))
  92 0044 8785      		ldd r24,Z+15
  93 0046 9089      		ldd r25,Z+16
  94               	.LVL4:
  95 0048 892B      		or r24,r25
  96 004a 01F0      		breq .L20
  97               	.LBB13:
  94:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     {
  95:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         return 0;
  96:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     }
  97:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
  98:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     BB_LOCK(SQ_LOCK)
  98               		.loc 1 98 0 is_stmt 1
  99 004c 2FB7      		in r18,__SREG__
 100               	.LVL5:
 101               	.LBB14:
 102               	.LBB15:
 103               		.file 2 "/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h"
   1:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** /* Copyright (c) 2007 Dean Camera
   2:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****    All rights reserved.
   3:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** 
   4:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****    Redistribution and use in source and binary forms, with or without
   5:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****    modification, are permitted provided that the following conditions are met:
   6:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** 
   7:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****    * Redistributions of source code must retain the above copyright
   8:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****      notice, this list of conditions and the following disclaimer.
   9:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** 
  10:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****    * Redistributions in binary form must reproduce the above copyright
  11:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****      notice, this list of conditions and the following disclaimer in
  12:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****      the documentation and/or other materials provided with the
  13:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****      distribution.
  14:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** 
  15:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****    * Neither the name of the copyright holders nor the names of
  16:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****      contributors may be used to endorse or promote products derived
  17:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****      from this software without specific prior written permission.
  18:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** 
  19:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****   THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
  20:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****   AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
  21:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****   IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
  22:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****   ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
  23:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****   LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
  24:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****   CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
  25:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****   SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
  26:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****   INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
  27:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****   CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
  28:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****   ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
  29:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****   POSSIBILITY OF SUCH DAMAGE.
  30:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** */
  31:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** 
  32:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** /* $Id: atomic.h 2158 2010-06-10 15:48:28Z joerg_wunsch $ */
  33:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** 
  34:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** #ifndef _UTIL_ATOMIC_H_
  35:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** #define _UTIL_ATOMIC_H_ 1
  36:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** 
  37:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** #include <avr/io.h>
  38:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** #include <avr/interrupt.h>
  39:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** 
  40:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** #if !defined(__DOXYGEN__)
  41:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** /* Internal helper functions. */
  42:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** static __inline__ uint8_t __iSeiRetVal(void)
  43:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** {
  44:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****     sei();
  45:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****     return 1;
  46:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** }
  47:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** 
  48:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** static __inline__ uint8_t __iCliRetVal(void)
  49:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** {
  50:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****     cli();
 104               		.loc 2 50 0
 105               	/* #APP */
 106               	 ;  50 "/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h" 1
 107 004e F894      		cli
 108               	 ;  0 "" 2
 109               	.LVL6:
 110               	/* #NOAPP */
 111               	.LBE15:
 112               	.LBE14:
  99:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 100:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     // get the first Chunk
 101:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     thisChunk = port[p].sq.head;
 113               		.loc 1 101 0
 114 0050 A785      		ldd r26,Z+15
 115 0052 B089      		ldd r27,Z+16
 102:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 103:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     // move the head of the queue
 104:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     port[p].sq.head = thisChunk->next;
 116               		.loc 1 104 0
 117 0054 5296      		adiw r26,18
 118 0056 8D91      		ld r24,X+
 119 0058 9C91      		ld r25,X
 120 005a 5397      		sbiw r26,18+1
 121 005c 8787      		std Z+15,r24
 122 005e 908B      		std Z+16,r25
 105:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 106:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     // tail was pointing to head, remove tail as well
 107:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     if( port[p].sq.head == NULL ) 
 123               		.loc 1 107 0
 124 0060 892B      		or r24,r25
 125 0062 01F0      		breq .L15
 126               	.LVL7:
 127               	.L21:
 128 0064 A093 0000 		sts thisChunk,r26
 129 0068 B093 0000 		sts thisChunk+1,r27
 130               	.LBB16:
 131               	.LBB17:
  51:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****     return 1;
  52:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** }
  53:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** 
  54:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** static __inline__ void __iSeiParam(const uint8_t *__s)
  55:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** {
  56:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****     sei();
  57:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****     __asm__ volatile ("" ::: "memory");
  58:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****     (void)__s;
  59:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** }
  60:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** 
  61:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** static __inline__ void __iCliParam(const uint8_t *__s)
  62:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** {
  63:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****     cli();
  64:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****     __asm__ volatile ("" ::: "memory");
  65:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****     (void)__s;
  66:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** }
  67:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** 
  68:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** static __inline__ void __iRestore(const  uint8_t *__s)
  69:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h **** {
  70:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****     SREG = *__s;
 132               		.loc 2 70 0
 133 006c 2FBF      		out __SREG__,r18
  71:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****     __asm__ volatile ("" ::: "memory");
 134               		.loc 2 71 0
 135               	.LBE17:
 136               	.LBE16:
 137               	.LBE13:
 108:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     {
 109:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         port[p].sq.tail   = NULL;
 110:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         port[p].sq.flags &= ~CHUNK_READY;
 111:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     }
 112:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     // otherwise, leave it to what it was pointing to
 113:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 114:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     BB_UNLOCK(SQ_LOCK)
 115:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 116:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     // remove thisChunk's references to queue
 117:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     thisChunk->next = NULL;
 138               		.loc 1 117 0
 139 006e A091 0000 		lds r26,thisChunk
 140 0072 B091 0000 		lds r27,thisChunk+1
 141 0076 5296      		adiw r26,18
 142 0078 1D92      		st X+,__zero_reg__
 143 007a 1C92      		st X,__zero_reg__
 144 007c 5397      		sbiw r26,18+1
 118:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 119:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     if(thisChunk->callback != NULL)
 145               		.loc 1 119 0
 146 007e 5696      		adiw r26,22
 147 0080 ED91      		ld r30,X+
 148 0082 FC91      		ld r31,X
 149 0084 5797      		sbiw r26,22+1
 150 0086 3097      		sbiw r30,0
 151 0088 01F4      		brne .L16
 152 008a 00C0      		rjmp .L17
 153               	.LVL8:
 154               	.L15:
 155               	.LBB18:
 109:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         port[p].sq.tail   = NULL;
 156               		.loc 1 109 0
 157 008c 118A      		std Z+17,__zero_reg__
 158 008e 128A      		std Z+18,__zero_reg__
 110:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         port[p].sq.flags &= ~CHUNK_READY;
 159               		.loc 1 110 0
 160 0090 8685      		ldd r24,Z+14
 161 0092 8F77      		andi r24,lo8(127)
 162 0094 8687      		std Z+14,r24
 163               	.LVL9:
 164 0096 00C0      		rjmp .L21
 165               	.LVL10:
 166               	.L16:
 167               	.LBE18:
 120:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     {
 121:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         // set response type for callback
 122:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         setChunkResponse(thisChunk, response);
 168               		.loc 1 122 0
 169 0098 6871      		andi r22,lo8(24)
 170               	.LVL11:
 171 009a 5196      		adiw r26,17
 172 009c 8C91      		ld r24,X
 173 009e 5197      		sbiw r26,17
 174 00a0 877E      		andi r24,lo8(-25)
 175 00a2 682B      		or r22,r24
 176 00a4 5196      		adiw r26,17
 177 00a6 6C93      		st X,r22
 123:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 	
 124:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         // execute callback to clear memory and other user actions
 125:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         (thisChunk->callback)();
 178               		.loc 1 125 0
 179 00a8 1995      		eicall
 180               	.LVL12:
 181               	.L17:
 126:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     }
 127:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 128:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     // we assume that the callback has freed memory
 129:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     thisChunk = NULL;
 182               		.loc 1 129 0
 183 00aa 1092 0000 		sts thisChunk,__zero_reg__
 184 00ae 1092 0000 		sts thisChunk+1,__zero_reg__
 130:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     return 1;
 185               		.loc 1 130 0
 186 00b2 81E0      		ldi r24,lo8(1)
 187 00b4 0895      		ret
 188               	.LVL13:
 189               	.L20:
  95:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         return 0;
 190               		.loc 1 95 0
 191 00b6 80E0      		ldi r24,0
 131:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** }
 192               		.loc 1 131 0
 193 00b8 0895      		ret
 194               	.LFE8:
 196               	.global	flushSendQueue
 198               	flushSendQueue:
 199               	.LFB9:
 132:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 133:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** // flush a send queue (used when retries fails)
 134:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** void flushSendQueue(PRef p)
 135:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** {
 200               		.loc 1 135 0
 201               	.LVL14:
 202 00ba CF93      		push r28
 203               	.LCFI0:
 204               	/* prologue: function */
 205               	/* frame size = 0 */
 206               	/* stack size = 1 */
 207               	.L__stack_usage = 1
 208 00bc C82F      		mov r28,r24
 136:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #ifdef LOG_DEBUG
 137:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 	if (isHostPort(p)) {
 138:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 		removeFromSq(p, MSG_RESP_NOREPLY); // ONLY ONE
 139:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 		return;
 140:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 	}
 141:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #endif
 142:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     if(p < NUM_PORTS)
 209               		.loc 1 142 0
 210 00be 8630      		cpi r24,lo8(6)
 211 00c0 00F4      		brsh .L22
 212               	.LVL15:
 213               	.L25:
 143:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     {
 144:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         // flush buffer (call all callbacks as if all messages failed)
 145:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         while( removeFromSq(p, MSG_RESP_NOREPLY) );
 214               		.loc 1 145 0
 215 00c2 68E1      		ldi r22,lo8(24)
 216 00c4 8C2F      		mov r24,r28
 217 00c6 0E94 0000 		call removeFromSq
 218               	.LVL16:
 219 00ca 8111      		cpse r24,__zero_reg__
 220 00cc 00C0      		rjmp .L25
 221               	.L22:
 222               	/* epilogue start */
 146:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     }
 147:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** }
 223               		.loc 1 147 0
 224 00ce CF91      		pop r28
 225               	.LVL17:
 226 00d0 0895      		ret
 227               	.LFE9:
 229               	.global	setupChunk
 231               	setupChunk:
 232               	.LFB10:
 148:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** ///////////////// END PROTECTED FUNCTIONS /////////////////
 149:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 150:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** //////////////////// PUBLIC FUNCTIONS /////////////////////
 151:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** // correctly formats/prepares all components of the chunk for sending
 152:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** // inputs:  c - chunk to format
 153:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** //          port - port to send on (0-NUM_PORTS only)
 154:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** //          msg - data associated with the message
 155:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** //          length - length of the data portion only
 156:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** //          mh - handler for this message
 157:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** //          cb - callback on send failure
 158:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** // outputs: 1 - chunk correctly formatted
 159:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** //          0 - inputs contained error, format failed
 160:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** byte setupChunk(Chunk* c, PRef p, byte * msg, byte length, MsgHandler mh, GenericHandler cb)
 161:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** {
 233               		.loc 1 161 0
 234               	.LVL18:
 235 00d2 EF92      		push r14
 236               	.LCFI1:
 237 00d4 FF92      		push r15
 238               	.LCFI2:
 239 00d6 0F93      		push r16
 240               	.LCFI3:
 241 00d8 1F93      		push r17
 242               	.LCFI4:
 243 00da CF93      		push r28
 244               	.LCFI5:
 245 00dc DF93      		push r29
 246               	.LCFI6:
 247               	/* prologue: function */
 248               	/* frame size = 0 */
 249               	/* stack size = 6 */
 250               	.L__stack_usage = 6
 251 00de EC01      		movw r28,r24
 252 00e0 CA01      		movw r24,r20
 253               	.LVL19:
 162:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     // invalid Chunk, invalid port, message too long, or no message
 163:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     if( (c == NULL) || (p >= NUM_PORTS) || (length > DATA_SIZE) || (msg == NULL) )
 254               		.loc 1 163 0
 255 00e2 2097      		sbiw r28,0
 256 00e4 01F0      		breq .L32
 257               		.loc 1 163 0 is_stmt 0 discriminator 1
 258 00e6 6630      		cpi r22,lo8(6)
 259 00e8 00F4      		brsh .L32
 260 00ea 2231      		cpi r18,lo8(18)
 261 00ec 00F4      		brsh .L32
 262 00ee 0097      		sbiw r24,0
 263 00f0 01F0      		breq .L32
 164:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     {
 165:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         return 0;
 166:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     }
 167:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 168:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     // set the flags
 169:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     c->status = CHUNK_USED | CHUNK_FILLED | MSG_RESP_SENDING | port[p].pnum;
 264               		.loc 1 169 0 is_stmt 1
 265 00f2 38E5      		ldi r19,lo8(88)
 266 00f4 639F      		mul r22,r19
 267 00f6 F001      		movw r30,r0
 268 00f8 1124      		clr __zero_reg__
 269 00fa E050      		subi r30,lo8(-(port))
 270 00fc F040      		sbci r31,hi8(-(port))
 271 00fe 3081      		ld r19,Z
 272 0100 3068      		ori r19,lo8(-128)
 273 0102 398B      		std Y+17,r19
 170:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     
 171:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     // clear out next pointer
 172:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     c->next = NULL;
 274               		.loc 1 172 0
 275 0104 1A8A      		std Y+18,__zero_reg__
 276 0106 1B8A      		std Y+19,__zero_reg__
 173:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 174:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     // set message handler
 175:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     *((MsgHandler*)(c->handler)) = mh;
 277               		.loc 1 175 0
 278 0108 0C8B      		std Y+20,r16
 279 010a 1D8B      		std Y+21,r17
 176:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 177:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     // setup callback
 178:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     c->callback = cb;
 280               		.loc 1 178 0
 281 010c EE8A      		std Y+22,r14
 282 010e FF8A      		std Y+23,r15
 179:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 180:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     // copy message
 181:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     memcpy(c->data, msg, length);
 283               		.loc 1 181 0
 284 0110 022F      		mov r16,r18
 285               	.LVL20:
 286 0112 10E0      		ldi r17,0
 287 0114 422F      		mov r20,r18
 288               	.LVL21:
 289 0116 50E0      		ldi r21,0
 290 0118 BC01      		movw r22,r24
 291               	.LVL22:
 292 011a CE01      		movw r24,r28
 293               	.LVL23:
 294 011c 0E94 0000 		call memcpy
 295               	.LVL24:
 182:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     
 183:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     // 'zero' out extra bytes (use ff's)
 184:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     memset((c->data)+length, 0xFF, DATA_SIZE-length);
 296               		.loc 1 184 0
 297 0120 C00F      		add r28,r16
 298 0122 D11F      		adc r29,r17
 299               	.LVL25:
 300 0124 41E1      		ldi r20,lo8(17)
 301 0126 50E0      		ldi r21,0
 302 0128 401B      		sub r20,r16
 303 012a 510B      		sbc r21,r17
 304 012c 6FEF      		ldi r22,lo8(-1)
 305 012e 70E0      		ldi r23,0
 306 0130 CE01      		movw r24,r28
 307 0132 0E94 0000 		call memset
 308               	.LVL26:
 185:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     
 186:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     return 1;
 309               		.loc 1 186 0
 310 0136 81E0      		ldi r24,lo8(1)
 311 0138 00C0      		rjmp .L28
 312               	.LVL27:
 313               	.L32:
 165:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         return 0;
 314               		.loc 1 165 0
 315 013a 80E0      		ldi r24,0
 316               	.LVL28:
 317               	.L28:
 318               	/* epilogue start */
 187:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** }
 319               		.loc 1 187 0
 320 013c DF91      		pop r29
 321 013e CF91      		pop r28
 322 0140 1F91      		pop r17
 323 0142 0F91      		pop r16
 324 0144 FF90      		pop r15
 325 0146 EF90      		pop r14
 326               	.LVL29:
 327 0148 0895      		ret
 328               	.LFE10:
 330               	.global	queueChunk
 332               	queueChunk:
 333               	.LFB11:
 188:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 189:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** // queues the chunk for sending
 190:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** // no guarantee chunk will be received - best-effort only
 191:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** // inputs:  c - correctly formatted chunk
 192:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** // outputs: 1 - chunk successfully queued
 193:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** //          0 - error, chunk was not queued
 194:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** byte queueChunk(Chunk* c)
 195:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** {
 334               		.loc 1 195 0
 335               	.LVL30:
 336               	/* prologue: function */
 337               	/* frame size = 0 */
 338               	/* stack size = 0 */
 339               	.L__stack_usage = 0
 196:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     // null Chunk
 197:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     if(c == NULL)
 340               		.loc 1 197 0
 341 014a 0097      		sbiw r24,0
 342 014c 01F0      		breq .L38
 198:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     {
 199:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         return 0;    
 200:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     }
 201:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     
 202:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     byte p = faceNum(c);
 343               		.loc 1 202 0
 344 014e DC01      		movw r26,r24
 345 0150 5196      		adiw r26,17
 346 0152 EC91      		ld r30,X
 347 0154 E770      		andi r30,lo8(7)
 348               	.LVL31:
 203:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     
 204:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     if(p < NUM_PORTS)
 349               		.loc 1 204 0
 350 0156 E630      		cpi r30,lo8(6)
 351 0158 00F4      		brsh .L35
 352               	.LBB19:
 205:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     {
 206:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #ifdef DEBUG
 207:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #if DEBUG == 5 // UP
 208:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 209:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #define DEBUGPORT 5
 210:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #define DEBUGUART USARTD1
 211:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 212:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #elif DEBUG == 1 // NORTH
 213:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 214:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #define DEBUGPORT 1
 215:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #define DEBUGUART USARTC1
 216:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 217:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #elif DEBUG == 4 //SOUTH
 218:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 219:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #define DEBUGPORT 4
 220:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #define DEBUGUART USARTE0
 221:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 222:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #elif DEBUG == 2 //EAST
 223:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 224:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #define DEBUGPORT 2
 225:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #define DEBUGUART USARTF0
 226:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 227:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #elif DEBUG == 3 //WEST
 228:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 229:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #define DEBUGPORT 3
 230:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #define DEBUGUART USARTC0
 231:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 232:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #elif DEBUG == 0 //DOWN
 233:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 234:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #define DEBUGPORT 0
 235:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #define DEBUGUART USARTD0
 236:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 237:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #endif
 238:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #ifndef DEBUGPORT
 239:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #error Invalid DEBUG option chosen - use a face enum.
 240:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #endif
 241:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 242:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         if(p == DEBUGPORT)
 243:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         {
 244:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****             freeChunk(c);
 245:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****             return 0;
 246:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         }
 247:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** #endif    
 248:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     
 249:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         BB_LOCK(SQ_LOCK)
 353               		.loc 1 249 0
 354 015a 6FB7      		in r22,__SREG__
 355               	.LVL32:
 356               	.LBB20:
 357               	.LBB21:
  50:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****     cli();
 358               		.loc 2 50 0
 359               	/* #APP */
 360               	 ;  50 "/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h" 1
 361 015c F894      		cli
 362               	 ;  0 "" 2
 363               	.LVL33:
 364               	/* #NOAPP */
 365               	.LBE21:
 366               	.LBE20:
 250:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 251:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         // add to queue - queue empty
 252:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         if( port[p].sq.head == NULL ) 
 367               		.loc 1 252 0
 368 015e 2E2F      		mov r18,r30
 369 0160 30E0      		ldi r19,0
 370 0162 B8E5      		ldi r27,lo8(88)
 371 0164 EB9F      		mul r30,r27
 372 0166 F001      		movw r30,r0
 373 0168 1124      		clr __zero_reg__
 374               	.LVL34:
 375 016a E050      		subi r30,lo8(-(port))
 376 016c F040      		sbci r31,hi8(-(port))
 377 016e 4785      		ldd r20,Z+15
 378 0170 5089      		ldd r21,Z+16
 379 0172 452B      		or r20,r21
 380 0174 01F4      		brne .L36
 253:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         {
 254:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****             port[p].sq.head = c;
 381               		.loc 1 254 0
 382 0176 8787      		std Z+15,r24
 383 0178 908B      		std Z+16,r25
 384 017a 00C0      		rjmp .L37
 385               	.L36:
 255:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         }
 256:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         // queue has stuff
 257:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         else 
 258:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         {
 259:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****             port[p].sq.tail->next = c;
 386               		.loc 1 259 0
 387 017c 0188      		ldd __tmp_reg__,Z+17
 388 017e F289      		ldd r31,Z+18
 389 0180 E02D      		mov r30,__tmp_reg__
 390 0182 828B      		std Z+18,r24
 391 0184 938B      		std Z+19,r25
 392               	.L37:
 260:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         }
 261:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         // add to tail and update flags
 262:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         port[p].sq.tail   = c;
 393               		.loc 1 262 0
 394 0186 48E5      		ldi r20,lo8(88)
 395 0188 429F      		mul r20,r18
 396 018a F001      		movw r30,r0
 397 018c 439F      		mul r20,r19
 398 018e F00D      		add r31,r0
 399 0190 1124      		clr __zero_reg__
 400 0192 E050      		subi r30,lo8(-(port))
 401 0194 F040      		sbci r31,hi8(-(port))
 402 0196 818B      		std Z+17,r24
 403 0198 928B      		std Z+18,r25
 263:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         port[p].sq.flags |= CHUNK_READY;
 404               		.loc 1 263 0
 405 019a 8685      		ldd r24,Z+14
 406               	.LVL35:
 407 019c 8068      		ori r24,lo8(-128)
 408 019e 8687      		std Z+14,r24
 409               	.LVL36:
 410               	.LBB22:
 411               	.LBB23:
  70:/usr/lib/gcc/avr/4.7.2/../../../avr/include/util/atomic.h ****     SREG = *__s;
 412               		.loc 2 70 0
 413 01a0 6FBF      		out __SREG__,r22
 414               		.loc 2 71 0
 415               	.LBE23:
 416               	.LBE22:
 417               	.LBE19:
 264:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 265:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         BB_UNLOCK(SQ_LOCK)
 266:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 267:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         return 1;
 418               		.loc 1 267 0
 419 01a2 81E0      		ldi r24,lo8(1)
 420 01a4 0895      		ret
 421               	.LVL37:
 422               	.L35:
 268:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     }
 269:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     else
 270:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     {
 271:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         freeChunk(c);
 423               		.loc 1 271 0
 424 01a6 0E94 0000 		call freeChunk
 425               	.LVL38:
 426               	.L38:
 199:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         return 0;    
 427               		.loc 1 199 0
 428 01aa 80E0      		ldi r24,0
 272:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         return 0;
 273:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     }
 274:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** }
 429               		.loc 1 274 0
 430 01ac 0895      		ret
 431               	.LFE11:
 433               	.global	handleOneMessage
 435               	handleOneMessage:
 436               	.LFB12:
 275:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 276:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** // call active message handler and send ack
 277:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** // returns: 1 - message processed
 278:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** //          0 - no new messages
 279:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** byte handleOneMessage()
 280:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** {
 437               		.loc 1 280 0
 438               	/* prologue: function */
 439               	/* frame size = 0 */
 440               	/* stack size = 0 */
 441               	.L__stack_usage = 0
 281:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     // set the global chunk that needs to be processed by the handler
 282:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     thisChunk = nextPacket();
 442               		.loc 1 282 0
 443 01ae 0E94 0000 		call nextPacket
 444               	.LVL39:
 445 01b2 8093 0000 		sts thisChunk,r24
 446 01b6 9093 0000 		sts thisChunk+1,r25
 283:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 284:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     // no packet, no action
 285:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     if( thisChunk == NULL )
 447               		.loc 1 285 0
 448 01ba 0097      		sbiw r24,0
 449 01bc 01F0      		breq .L43
 286:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     {
 287:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         return 0;
 288:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     }
 289:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 290:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     // call handler
 291:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     if( *((MsgHandler*)thisChunk->handler) == RES_SYS_HANDLER ) 
 450               		.loc 1 291 0
 451 01be DC01      		movw r26,r24
 452 01c0 5496      		adiw r26,20
 453 01c2 ED91      		ld r30,X+
 454 01c4 FC91      		ld r31,X
 455 01c6 5597      		sbiw r26,20+1
 456 01c8 3097      		sbiw r30,0
 457 01ca 01F4      		brne .L41
 292:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     {
 293:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 	    reservedSystemHandler();
 458               		.loc 1 293 0
 459 01cc 0E94 0000 		call reservedSystemHandler
 460               	.LVL40:
 461 01d0 00C0      		rjmp .L42
 462               	.L41:
 294:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     }
 295:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     else 
 296:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     {
 297:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 	    (*((MsgHandler*)(thisChunk->handler)))();
 463               		.loc 1 297 0
 464 01d2 1995      		eicall
 465               	.LVL41:
 466               	.L42:
 298:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     }
 299:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 300:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     // set flag to send ACK
 301:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     port[faceNum(thisChunk)].sq.flags |= setAck(thisChunk);
 467               		.loc 1 301 0
 468 01d4 8091 0000 		lds r24,thisChunk
 469 01d8 9091 0000 		lds r25,thisChunk+1
 470 01dc FC01      		movw r30,r24
 471 01de 2189      		ldd r18,Z+17
 472 01e0 E22F      		mov r30,r18
 473 01e2 E770      		andi r30,lo8(7)
 474 01e4 38E5      		ldi r19,lo8(88)
 475 01e6 E39F      		mul r30,r19
 476 01e8 F001      		movw r30,r0
 477 01ea 1124      		clr __zero_reg__
 478 01ec E050      		subi r30,lo8(-(port))
 479 01ee F040      		sbci r31,hi8(-(port))
 480 01f0 25FB      		bst r18,5
 481 01f2 4427      		clr r20
 482 01f4 40F9      		bld r20,0
 483 01f6 21E0      		ldi r18,lo8(1)
 484 01f8 30E0      		ldi r19,0
 485 01fa 00C0      		rjmp 2f
 486               		1:
 487 01fc 220F      		lsl r18
 488               		2:
 489 01fe 4A95      		dec r20
 490 0200 02F4      		brpl 1b
 491 0202 3685      		ldd r19,Z+14
 492 0204 322B      		or r19,r18
 493 0206 3687      		std Z+14,r19
 302:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 303:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     // free the rx chunk
 304:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     freeChunk(thisChunk);
 494               		.loc 1 304 0
 495 0208 0E94 0000 		call freeChunk
 496               	.LVL42:
 305:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 306:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     // reset the global chunk since memory is no longer valid
 307:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     thisChunk = NULL;
 497               		.loc 1 307 0
 498 020c 1092 0000 		sts thisChunk,__zero_reg__
 499 0210 1092 0000 		sts thisChunk+1,__zero_reg__
 308:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 309:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     return 1;
 500               		.loc 1 309 0
 501 0214 81E0      		ldi r24,lo8(1)
 502 0216 0895      		ret
 503               	.L43:
 287:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****         return 0;
 504               		.loc 1 287 0
 505 0218 80E0      		ldi r24,0
 310:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** }
 506               		.loc 1 310 0
 507 021a 0895      		ret
 508               	.LFE12:
 510               	.global	initDataLink
 512               	initDataLink:
 513               	.LFB13:
 311:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 312:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** // initialization
 313:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** void initDataLink()
 314:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** {
 514               		.loc 1 314 0
 515               	/* prologue: function */
 516               	/* frame size = 0 */
 517               	/* stack size = 0 */
 518               	.L__stack_usage = 0
 315:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     initHWDataLink();
 519               		.loc 1 315 0
 520 021c 0E94 0000 		call initHWDataLink
 521               	.LVL43:
 316:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb **** 
 317:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     globalRq.head  = NULL;
 522               		.loc 1 317 0
 523 0220 1092 0000 		sts globalRq,__zero_reg__
 524 0224 1092 0000 		sts globalRq+1,__zero_reg__
 318:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     globalRq.tail  = NULL;
 525               		.loc 1 318 0
 526 0228 1092 0000 		sts globalRq+2,__zero_reg__
 527 022c 1092 0000 		sts globalRq+2+1,__zero_reg__
 319:/home/pthalamy/CMU/build-modif/src-bobby/system/data_link.bb ****     globalRq.flags = 0;
 528               		.loc 1 319 0
 529 0230 1092 0000 		sts globalRq+4,__zero_reg__
 530 0234 0895      		ret
 531               	.LFE13:
 533               		.comm	thisChunk,2,1
 534               		.comm	globalRq,5,1
 659               	.Letext0:
 660               		.file 3 "/usr/lib/gcc/avr/4.7.2/../../../avr/include/stdint.h"
 661               		.file 4 "/home/pthalamy/CMU/build-modif/src-bobby/system/defs.bbh"
 662               		.file 5 "/usr/lib/gcc/avr/4.7.2/include/stddef.h"
 663               		.file 6 "/home/pthalamy/CMU/build-modif/src-bobby/system/circ_buffer.bbh"
 664               		.file 7 "/home/pthalamy/CMU/build-modif/src-bobby/system/handler.bbh"
 665               		.file 8 "/home/pthalamy/CMU/build-modif/src-bobby/system/memory.bbh"
 666               		.file 9 "/home/pthalamy/CMU/build-modif/src-bobby/system/hardwaretime.bbh"
 667               		.file 10 "/home/pthalamy/CMU/build-modif/src-bobby/system/queues.bbh"
 668               		.file 11 "/home/pthalamy/CMU/build-modif/src-bobby/system/serial.bbh"
 669               		.file 12 "/home/pthalamy/CMU/build-modif/src-bobby/system/ensemble.bbh"
 670               		.file 13 "/home/pthalamy/CMU/build-modif/src-bobby/system/clock.bbh"
 671               		.file 14 "/home/pthalamy/CMU/build-modif/src-bobby/system/../hw-api/hwDataLink.h"
 672               		.file 15 "/home/pthalamy/CMU/build-modif/src-bobby/system/boot.bbh"
 673               		.file 16 "/usr/lib/gcc/avr/4.7.2/../../../avr/include/string.h"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 data_link.c
     /tmp/ccaLw5fn.s:2      *ABS*:000000000000003e __SP_H__
     /tmp/ccaLw5fn.s:3      *ABS*:000000000000003d __SP_L__
     /tmp/ccaLw5fn.s:4      *ABS*:000000000000003f __SREG__
     /tmp/ccaLw5fn.s:5      *ABS*:000000000000003b __RAMPZ__
     /tmp/ccaLw5fn.s:6      *ABS*:0000000000000034 __CCP__
     /tmp/ccaLw5fn.s:7      *ABS*:0000000000000000 __tmp_reg__
     /tmp/ccaLw5fn.s:8      *ABS*:0000000000000001 __zero_reg__
     /tmp/ccaLw5fn.s:13     .text:0000000000000000 defaultMsgHandler
     /tmp/ccaLw5fn.s:28     .text:0000000000000004 reservedSystemHandler
                            *COM*:0000000000000002 thisChunk
     /tmp/ccaLw5fn.s:73     .text:0000000000000032 removeFromSq
     /tmp/ccaLw5fn.s:198    .text:00000000000000ba flushSendQueue
     /tmp/ccaLw5fn.s:231    .text:00000000000000d2 setupChunk
     /tmp/ccaLw5fn.s:332    .text:000000000000014a queueChunk
     /tmp/ccaLw5fn.s:435    .text:00000000000001ae handleOneMessage
     /tmp/ccaLw5fn.s:512    .text:000000000000021c initDataLink
                            *COM*:0000000000000005 globalRq

UNDEFINED SYMBOLS
jumpToBootSection
handleNeighborMessage
handleClockSyncMessage
port
memcpy
memset
freeChunk
nextPacket
initHWDataLink
__do_clear_bss
