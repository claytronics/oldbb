   1               		.file	"hwMemory.c"
   2               	__SP_H__ = 0x3e
   3               	__SP_L__ = 0x3d
   4               	__SREG__ = 0x3f
   5               	__RAMPZ__ = 0x3b
   6               	__CCP__ = 0x34
   7               	__tmp_reg__ = 0
   8               	__zero_reg__ = 1
   9               		.text
  10               	.Ltext0:
  11               	.global	store
  13               	store:
  14               	.LFB13:
  15               		.file 1 "/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c"
   1:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** #include <stdio.h>
   2:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** #include "../system/handler.h"
   3:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** #include "../hw-api/hwMemory.h"
   4:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** 
   5:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** // HARDWARE INCLUDE
   6:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** #ifndef HOST
   7:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** #include "eeprom_driver.h"
   8:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** #endif
   9:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** 
  10:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** // Stores a data structure in EEPROM.  Writes it in pages to take a reasonable length of time.
  11:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** //
  12:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** //  nv_addr points to the desired EEMEM structure address (if you declared it using 'type EEMEM myd
  13:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** //  data points to the desired SRAM structure address
  14:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** //  len    is sizeof(type)
  15:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** void store(void * nv_addr, void * data, int len)
  16:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** {
  16               		.loc 1 16 0
  17               	.LVL0:
  18 0000 CF92      		push r12
  19               	.LCFI0:
  20 0002 DF92      		push r13
  21               	.LCFI1:
  22 0004 EF92      		push r14
  23               	.LCFI2:
  24 0006 FF92      		push r15
  25               	.LCFI3:
  26 0008 0F93      		push r16
  27               	.LCFI4:
  28 000a 1F93      		push r17
  29               	.LCFI5:
  30 000c CF93      		push r28
  31               	.LCFI6:
  32 000e DF93      		push r29
  33               	.LCFI7:
  34               	/* prologue: function */
  35               	/* frame size = 0 */
  36               	/* stack size = 8 */
  37               	.L__stack_usage = 8
  38 0010 8C01      		movw r16,r24
  39 0012 7B01      		movw r14,r22
  40 0014 EA01      		movw r28,r20
  17:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****     uint8_t partial_offset, partial_length;
  18:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** 
  19:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****     while(len != 0)
  20:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****     {
  21:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****         // grab the page offset address from the current
  22:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****         partial_offset = (uint16_t)nv_addr & (EEPROM_PAGESIZE - 1);
  23:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****     
  24:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****         partial_length = EEPROM_PAGESIZE - partial_offset;
  41               		.loc 1 24 0
  42 0016 30E2      		ldi r19,lo8(32)
  43 0018 C32E      		mov r12,r19
  19:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****     while(len != 0)
  44               		.loc 1 19 0
  45 001a 00C0      		rjmp .L2
  46               	.LVL1:
  47               	.L4:
  22:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****         partial_offset = (uint16_t)nv_addr & (EEPROM_PAGESIZE - 1);
  48               		.loc 1 22 0
  49 001c 602F      		mov r22,r16
  50 001e 6F71      		andi r22,lo8(31)
  51               	.LVL2:
  52               		.loc 1 24 0
  53 0020 DC2C      		mov r13,r12
  54 0022 D61A      		sub r13,r22
  55               	.LVL3:
  25:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****         
  26:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****         if(partial_length > len)
  56               		.loc 1 26 0
  57 0024 8D2D      		mov r24,r13
  58 0026 90E0      		ldi r25,0
  59 0028 C817      		cp r28,r24
  60 002a D907      		cpc r29,r25
  61 002c 04F4      		brge .L3
  27:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****         {
  28:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****             partial_length = len;
  62               		.loc 1 28 0
  63 002e DC2E      		mov r13,r28
  64               	.LVL4:
  65               	.L3:
  29:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****         }
  30:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** 
  31:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****         EEPROM_LoadPartialPage(data, partial_offset, partial_length);
  66               		.loc 1 31 0
  67 0030 4D2D      		mov r20,r13
  68 0032 C701      		movw r24,r14
  69 0034 0E94 0000 		call EEPROM_LoadPartialPage
  70               	.LVL5:
  32:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****         EEPROM_AtomicWritePage((uint16_t)nv_addr / (EEPROM_PAGESIZE));
  71               		.loc 1 32 0
  72 0038 C801      		movw r24,r16
  73 003a 25E0      		ldi r18,5
  74               		1:
  75 003c 9695      		lsr r25
  76 003e 8795      		ror r24
  77 0040 2A95      		dec r18
  78 0042 01F4      		brne 1b
  79 0044 0E94 0000 		call EEPROM_AtomicWritePage
  80               	.LVL6:
  33:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** 
  34:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****         len -= partial_length;
  81               		.loc 1 34 0
  82 0048 4D2D      		mov r20,r13
  83 004a 50E0      		ldi r21,0
  84 004c C41B      		sub r28,r20
  85 004e D50B      		sbc r29,r21
  86               	.LVL7:
  35:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****         nv_addr += partial_length;
  87               		.loc 1 35 0
  88 0050 040F      		add r16,r20
  89 0052 151F      		adc r17,r21
  90               	.LVL8:
  36:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****         data += partial_length;
  91               		.loc 1 36 0
  92 0054 E40E      		add r14,r20
  93 0056 F51E      		adc r15,r21
  94               	.LVL9:
  95               	.L2:
  19:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****     while(len != 0)
  96               		.loc 1 19 0 discriminator 1
  97 0058 2097      		sbiw r28,0
  98 005a 01F4      		brne .L4
  99               	/* epilogue start */
  37:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****     }
  38:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****     
  39:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** }
 100               		.loc 1 39 0
 101 005c DF91      		pop r29
 102 005e CF91      		pop r28
 103               	.LVL10:
 104 0060 1F91      		pop r17
 105 0062 0F91      		pop r16
 106               	.LVL11:
 107 0064 FF90      		pop r15
 108 0066 EF90      		pop r14
 109               	.LVL12:
 110 0068 DF90      		pop r13
 111 006a CF90      		pop r12
 112 006c 0895      		ret
 113               	.LFE13:
 115               	.global	restore
 117               	restore:
 118               	.LFB14:
  40:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** 
  41:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** // this could be done in pages but reads are pretty quick so it shouldn't matter
  42:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** void restore(void * vaddr, void * vnv_addr, int len)
  43:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** {    
 119               		.loc 1 43 0
 120               	.LVL13:
 121 006e EF92      		push r14
 122               	.LCFI8:
 123 0070 FF92      		push r15
 124               	.LCFI9:
 125 0072 0F93      		push r16
 126               	.LCFI10:
 127 0074 1F93      		push r17
 128               	.LCFI11:
 129 0076 CF93      		push r28
 130               	.LCFI12:
 131 0078 DF93      		push r29
 132               	.LCFI13:
 133               	/* prologue: function */
 134               	/* frame size = 0 */
 135               	/* stack size = 6 */
 136               	.L__stack_usage = 6
 137 007a 7A01      		movw r14,r20
 138               	.LVL14:
  42:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** void restore(void * vaddr, void * vnv_addr, int len)
 139               		.loc 1 42 0
 140 007c E60E      		add r14,r22
 141 007e F71E      		adc r15,r23
  44:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** 	byte *addr=(byte *)vaddr;
  45:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** 	byte *nv_addr=(byte *) vnv_addr;
 142               		.loc 1 45 0
 143 0080 EB01      		movw r28,r22
  44:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** 	byte *addr=(byte *)vaddr;
 144               		.loc 1 44 0
 145 0082 8C01      		movw r16,r24
  46:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****     while(len != 0)
 146               		.loc 1 46 0
 147 0084 00C0      		rjmp .L6
 148               	.LVL15:
 149               	.L7:
  47:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****     {
  48:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****         *addr = EEPROM_ReadByte(((uint16_t)(nv_addr) / (EEPROM_PAGESIZE)), (uint16_t)(nv_addr) & (E
 150               		.loc 1 48 0
 151 0086 BE01      		movw r22,r28
 152 0088 6F71      		andi r22,31
 153 008a 7727      		clr r23
 154 008c CE01      		movw r24,r28
 155 008e 45E0      		ldi r20,5
 156               		1:
 157 0090 9695      		lsr r25
 158 0092 8795      		ror r24
 159 0094 4A95      		dec r20
 160 0096 01F4      		brne 1b
 161 0098 0E94 0000 		call EEPROM_ReadByte
 162               	.LVL16:
 163 009c F801      		movw r30,r16
 164 009e 8193      		st Z+,r24
 165 00a0 8F01      		movw r16,r30
 166               	.LVL17:
  49:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****         nv_addr++;
 167               		.loc 1 49 0
 168 00a2 2196      		adiw r28,1
 169               	.LVL18:
 170               	.L6:
  46:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****     while(len != 0)
 171               		.loc 1 46 0 discriminator 1
 172 00a4 CE15      		cp r28,r14
 173 00a6 DF05      		cpc r29,r15
 174 00a8 01F4      		brne .L7
 175               	/* epilogue start */
  50:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****         addr++;
  51:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****         len--;
  52:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****     }
  53:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** }
 176               		.loc 1 53 0
 177 00aa DF91      		pop r29
 178 00ac CF91      		pop r28
 179               	.LVL19:
 180 00ae 1F91      		pop r17
 181 00b0 0F91      		pop r16
 182               	.LVL20:
 183 00b2 FF90      		pop r15
 184 00b4 EF90      		pop r14
 185 00b6 0895      		ret
 186               	.LFE14:
 188               	.global	getGUID
 190               	getGUID:
 191               	.LFB15:
  54:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** 
  55:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** #define ID_PAGE_ADDR 0x00
  56:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** #define ID_BYTE_ADDR 0x00
  57:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** 
  58:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** 
  59:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** /* TODO: This is WRONG. It should be Uid, but the build system is being stupid and now is not a goo
  60:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** //reads GUID from eeprom
  61:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** uint16_t getGUID(){
 192               		.loc 1 61 0
 193 00b8 CF93      		push r28
 194               	.LCFI14:
 195               	/* prologue: function */
 196               	/* frame size = 0 */
 197               	/* stack size = 1 */
 198               	.L__stack_usage = 1
  62:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****   //return 255;
  63:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** 	//TODO: read from eeprom
  64:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****   return (((uint16_t)EEPROM_ReadByte(ID_PAGE_ADDR, ID_BYTE_ADDR))<<8) |
 199               		.loc 1 64 0
 200 00ba 60E0      		ldi r22,0
 201 00bc 80E0      		ldi r24,0
 202 00be 0E94 0000 		call EEPROM_ReadByte
 203               	.LVL21:
 204 00c2 C82F      		mov r28,r24
  65:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** 	  ((uint16_t)EEPROM_ReadByte(ID_PAGE_ADDR, ID_BYTE_ADDR+1));
 205               		.loc 1 65 0
 206 00c4 61E0      		ldi r22,lo8(1)
 207 00c6 80E0      		ldi r24,0
 208 00c8 0E94 0000 		call EEPROM_ReadByte
 209               	.LVL22:
  64:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c ****   return (((uint16_t)EEPROM_ReadByte(ID_PAGE_ADDR, ID_BYTE_ADDR))<<8) |
 210               		.loc 1 64 0
 211 00cc 3C2F      		mov r19,r28
 212 00ce 20E0      		ldi r18,0
 213 00d0 282B      		or r18,r24
  66:/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/hwMemory.c **** }
 214               		.loc 1 66 0
 215 00d2 C901      		movw r24,r18
 216               	/* epilogue start */
 217 00d4 CF91      		pop r28
 218 00d6 0895      		ret
 219               	.LFE15:
 353               	.Letext0:
 354               		.file 2 "/usr/lib/gcc/avr/4.7.2/../../../avr/include/stdint.h"
 355               		.file 3 "/home/pthalamy/CMU/oldbb/build/src-bobby/system/defs.bbh"
 356               		.file 4 "/home/pthalamy/CMU/oldbb/build/src-bobby/hw-block/eeprom_driver.h"
DEFINED SYMBOLS
                            *ABS*:0000000000000000 hwMemory.c
     /tmp/cch7YhDX.s:2      *ABS*:000000000000003e __SP_H__
     /tmp/cch7YhDX.s:3      *ABS*:000000000000003d __SP_L__
     /tmp/cch7YhDX.s:4      *ABS*:000000000000003f __SREG__
     /tmp/cch7YhDX.s:5      *ABS*:000000000000003b __RAMPZ__
     /tmp/cch7YhDX.s:6      *ABS*:0000000000000034 __CCP__
     /tmp/cch7YhDX.s:7      *ABS*:0000000000000000 __tmp_reg__
     /tmp/cch7YhDX.s:8      *ABS*:0000000000000001 __zero_reg__
     /tmp/cch7YhDX.s:13     .text:0000000000000000 store
     /tmp/cch7YhDX.s:117    .text:000000000000006e restore
     /tmp/cch7YhDX.s:190    .text:00000000000000b8 getGUID

UNDEFINED SYMBOLS
EEPROM_LoadPartialPage
EEPROM_AtomicWritePage
EEPROM_ReadByte
